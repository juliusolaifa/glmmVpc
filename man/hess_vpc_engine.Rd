% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/vpc_ci.R
\name{hess_vpc_engine}
\alias{hess_vpc_engine}
\title{Hessian of the VPC for Negative‑Binomial or Tweedie GLMMs}
\usage{
hess_vpc_engine(beta, Sigma, phi, family, x = NULL, power = NULL, method)
}
\arguments{
\item{beta}{Numeric vector of fixed‑effect coefficients
\eqn{(\beta_0, \beta_1, \dots)}.}

\item{Sigma}{Covariance matrix of the random effects (square, symmetric).}

\item{phi}{Dispersion parameter:
\itemize{
\item negative‑binomial: inverse size (i.e. 1/\eqn{k});
\item tweedie: precision \eqn{\phi}.
}}

\item{family}{Character string, one of \code{"negative_binomial"} or
\code{"tweedie"}.}

\item{x}{Optional design vector (or matrix) of covariates passed to
\code{mu()} and \code{sig()}.  If \code{NULL}, those helpers must handle
the absence of covariates internally.}

\item{power}{Tweedie power parameter \eqn{p}.  \strong{Required} when
\code{family == "tweedie"}; ignored otherwise.}

\item{method}{Character, currently only \code{"numerical"} is implemented.}
}
\value{
A square numeric matrix – the Hessian of the VPC with row/column
names matching the parameter vector order
\code{c(beta, phi, vech(Sigma))}.
}
\description{
Computes the numerical Hessian of the variance–partitioning coefficient (VPC)
with respect to the full parameter vector
\eqn{\Theta = (\beta, \phi, \operatorname{vech}(\Sigma))}.
The function builds a temporary, family‑specific wrapper around your
mean/variance helpers (\code{mu()}, \code{sig()}) and VPC calculators
(\code{vpc.nb()}, \code{vpc.tw()}), then calls \strong{numDeriv}’s
\code{\link[numDeriv]{hessian}}.
}
\details{
The function:
\enumerate{
\item Constructs a parameterised function
\eqn{f(\Theta)} that returns the VPC for the chosen family;
\item Dumps that function into an R expression via \code{eval(parse())};
\item Calls \code{numDeriv::hessian()} at the supplied parameter values.
}
Helper utilities that must exist in the calling environment:
\itemize{
\item \code{construct_beta_param_str()}, \code{construct_sigma_param_str()}
– build comma‑separated parameter names for dynamic evaluation.
\item \code{mat2vec()} – half‑vectorises \eqn{\Sigma}.
\item \code{mu()}, \code{sig()} – mean/variance functions.
\item \code{vpc.nb()}, \code{vpc.tw()} – family‑specific VPC calculators.
}
}
\examples{
# Example for Negative Binomial family
beta <- c(1, 2)
Sigma <- matrix(c(1, 0.5, 0.5, 1), nrow = 2)
phi <- 1.5
x <- 1
hess_vpc_engine(beta, Sigma, phi, family = "negative_binomial", x=1,method = "numerical")

# Example for Tweedie family
power <- 1.5
hess_vpc_engine(beta, Sigma, phi, family = "tweedie", x=1, power = power, method = "numerical")

}
